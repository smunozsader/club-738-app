# ğŸ“§ Modal de Preview y EdiciÃ³n de Recordatorios - v1.35.4

**Fecha de ImplementaciÃ³n**: 24 Enero 2026  
**VersiÃ³n**: v1.35.4  
**Estado**: âœ… PRODUCCIÃ“N  

---

## ğŸ¯ Objetivo Principal

**Evitar SPAM y permitir personalizaciÃ³n de mensajes** antes de enviar recordatorios a socios pendientes.

En lugar de enviar automÃ¡ticamente, ahora tienes la oportunidad de:
- âœ… Revisar cada mensaje individualmente
- âœ… Editar el contenido para personalizarlo
- âœ… Navegar entre todos los destinatarios
- âœ… Confirmar antes de enviar

---

## ğŸš€ CÃ³mo Usar

### Paso 1: Abre Reporte Contable
1. Ve a Admin â†’ Panel Cobranza â†’ Reporte Contable
2. VerÃ¡s la secciÃ³n **"ğŸ“¢ ENVIAR RECORDATORIOS A PENDIENTES"**

### Paso 2: Elige el Canal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¢ ENVIAR RECORDATORIOS A PENDIENTES   â”‚
â”‚ â° Plazo lÃ­mite: 28 de febrero de 2026 â”‚
â”‚                                         â”‚
â”‚  [ğŸ“§ Enviar por Email (7)]              â”‚
â”‚  [ğŸ’¬ Enviar por WhatsApp (7)]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

El nÃºmero entre parÃ©ntesis indica cuÃ¡ntos socios pendientes hay.

### Paso 3: Se Abre el Modal de Preview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ” Revisar Mensajes - EMAIL                           âœ•  â•‘
â•‘ Mensaje 1 de 7                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘ DESTINATARIO:                                            â•‘
â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘ â”‚ Luis Fernando Guillermo Gamboa                       â”‚  â•‘
â•‘ â”‚ ğŸ“§ luis.fernando@email.com                          â”‚  â•‘
â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                           â•‘
â•‘ MENSAJE (EDITABLE):                                      â•‘
â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘ â”‚ Estimado(a) Luis Fernando,                          â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â”‚ Le recordamos que debe realizar su pago de          â”‚  â•‘
â•‘ â”‚ renovaciÃ³n de membresÃ­a antes del 28 de febrero     â”‚  â•‘
â•‘ â”‚ de 2026.                                            â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â”‚ MONTO A PAGAR: $6,500 MXN                          â”‚  â•‘
â•‘ â”‚ CONCEPTO: Cuota de RenovaciÃ³n 2026                â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â”‚ Para realizar su pago, favor de contactar          â”‚  â•‘
â•‘ â”‚ directamente con la tesorerÃ­a del club.            â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â”‚ Agradecemos su puntualidad.                        â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â”‚ ---                                                  â”‚  â•‘
â•‘ â”‚ Club de Caza, Tiro y Pesca de YucatÃ¡n, A.C.       â”‚  â•‘
â•‘ â”‚ Tel: +52 56 6582 4667                             â”‚  â•‘
â•‘ â”‚                                                       â”‚  â•‘
â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘ 356 caracteres                                            â•‘
â•‘                                                           â•‘
â•‘  [â† Anterior]    [Siguiente â†’]                           â•‘
â•‘                                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ [âŒ Cancelar]    [âœ… Enviar 7 Recordatorios]             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Paso 4: Personaliza el Mensaje (Opcional)

Puedes **editar el mensaje directamente en el textarea**:

- âœï¸ AÃ±ade informaciÃ³n personal
- âœï¸ Cambia el tono si es necesario
- âœï¸ Agrega detalles especÃ­ficos del socio
- âœï¸ El contador de caracteres actualiza en tiempo real

**Ejemplo - Antes**:
```
Estimado(a) Luis Fernando,

Le recordamos que debe realizar su pago...
```

**Ejemplo - DespuÃ©s (Personalizado)**:
```
Estimado Lucho,

Â¡Nos falta tu pago para completar el registro! Recuerda que el plazo vence el 28 de febrero.

Tu cuota anual 2026 es de $6,500 MXN. Puedes pagar con Ricardo en tesorerÃ­a o transferir a la cuenta del club.

Â¡Vamos, que es rÃ¡pido! ğŸ’ª

Club de Caza, Tiro y Pesca de YucatÃ¡n
Tel: +52 56 6582 4667
```

### Paso 5: Navega Entre los Mensajes

Use los botones **Anterior** y **Siguiente** para revisar cada destinatario:

- `[â† Anterior]` - Deshabilitado en el primer mensaje
- `[Siguiente â†’]` - Deshabilitado en el Ãºltimo mensaje
- El contador superior muestra: "Mensaje 1 de 7"

### Paso 6: Confirma el EnvÃ­o

Cuando estÃ©s satisfecho con todos los mensajes, haz clic en:

```
[âœ… Enviar 7 Recordatorios]
```

- El botÃ³n muestra la cantidad total de mensajes
- Al hacer clic, se envÃ­an TODOS los mensajes editados
- VerÃ¡s un toast confirmando: "7 recordatorios por email âœ“"

### Paso 7: Cancelar (Si Cambias de Idea)

En cualquier momento puedes hacer clic en:

```
[âŒ Cancelar]
```

O en la **X** en la esquina superior derecha del modal para cerrar sin enviar nada.

---

## ğŸ“Š Diferencias: Email vs WhatsApp

### ğŸ“§ Email

**Tono**: Formal, profesional  
**Formato**: PÃ¡rrafos completos  
**MÃ¡ximo**: Sin lÃ­mite de caracteres (pero el contador te ayuda)  

**Ejemplo Predefinido**:
```
Estimado(a) [NOMBRE],

Le recordamos que debe realizar su pago de renovaciÃ³n de membresÃ­a antes del 
28 de febrero de 2026.

MONTO A PAGAR: $6,500 MXN
CONCEPTO: Cuota de RenovaciÃ³n 2026

Para realizar su pago, favor de contactar directamente con la tesorerÃ­a del club.

Agradecemos su puntualidad.

---
Club de Caza, Tiro y Pesca de YucatÃ¡n, A.C.
Calle 50 No. 531-E x 69 y 71, Col. Centro, 97000 MÃ©rida, YucatÃ¡n
Tel: +52 56 6582 4667
```

---

### ğŸ’¬ WhatsApp

**Tono**: Informal, amigable  
**Formato**: Mensajes cortos, emojis  
**MÃ¡ximo**: Idealmente <160 caracteres por mensaje (estÃ¡ndar SMS)  

**Ejemplo Predefinido**:
```
Â¡Hola [NOMBRE]! ğŸ‘‹

Recordatorio importante: Tu renovaciÃ³n de membresÃ­a vence el 28 de febrero de 2026.

ğŸ’° Monto: $6,500 MXN
ğŸ“‹ Concepto: Cuota Anual 2026

Favor contactar al club para procesar tu pago.

ğŸ¹ Club de Caza, Tiro y Pesca de YucatÃ¡n
TelÃ©fono: +52 56 6582 4667
```

---

## âš™ï¸ Detalles TÃ©cnicos

### Estados del Modal

| Estado | DescripciÃ³n |
|--------|-------------|
| **Cerrado** | Normal, ver botones "Enviar por Email/WhatsApp" |
| **Abierto** | Modal visible con mensaje editable |
| **Enviando** | El botÃ³n "Enviar" muestra "â³ Enviando..." (deshabilitado) |
| **Completado** | Se cierra automÃ¡ticamente despuÃ©s del envÃ­o |

### Funciones Principales

```javascript
// 1. Mostrar modal con mensajes generados
enviarRecordatoriosPendientes(tipo: 'email' | 'whatsapp')

// 2. Generar mensajes personalizados para cada socio
generarMensajesPersonalizados(socios, tipo)

// 3. Actualizar un mensaje individual
actualizarMensaje(nuevoMensaje)

// 4. Enviar todos los mensajes a Cloud Function
confirmarEnvio()

// 5. Cerrar modal sin enviar
cancelarEnvio()
```

### Cloud Function Actualizada

La funciÃ³n `enviarRecordatorios` ahora acepta **dos formatos**:

**Formato Nuevo (Recomendado)**:
```javascript
{
  tipo: 'email' | 'whatsapp',
  mensajes: [
    {
      email: 'user@email.com',
      nombre: 'Luis Fernando',
      telefono: '+5291234567',
      mensaje: 'Mensaje personalizado...'
    },
    // ... mÃ¡s mensajes
  ]
}
```

**Formato Antiguo (Legacy - Sigue Funcionando)**:
```javascript
{
  tipo: 'email' | 'whatsapp',
  socios: [
    {
      email: 'user@email.com',
      nombre: 'Luis Fernando',
      telefono: '+5291234567',
      monto: 6500
    },
    // ... mÃ¡s socios
  ]
}
```

---

## ğŸ¨ Estilos CSS

El modal es completamente **responsivo**:

### Desktop (â‰¥900px)
- Modal: 700px de ancho
- Textarea: 12 filas visibles
- Botones: Lado a lado

### Tablet (600px - 900px)
- Modal: 90% del ancho
- Textarea: 10 filas
- Botones: Lado a lado

### Mobile (<600px)
- Modal: Full-width con padding
- Textarea: 8 filas
- Botones: Full-width (stack vertical)

---

## âš ï¸ Notas Importantes

### PrevenciÃ³n de SPAM

1. **Lee cada mensaje** antes de enviar
2. **Evita enviar demasiado frecuentemente** (mÃ¡ximo 1-2 veces por semana)
3. **Personaliza si es posible** (aumenta tasa de respuesta)
4. **Verifica destinatarios** (especialmente WhatsApp)
5. **Respeta el deadline** de 28 de febrero

### LÃ­mites TÃ©cnicos

- âœ… MÃ¡ximo socios por envÃ­o: Ilimitado (procesado en Cloud Function)
- âœ… Caracteres por mensaje: Ilimitado (pero contador te advierte)
- âœ… Formatos soportados: Email, WhatsApp (futuro: SMS, Telegram)
- â³ Tiempo de envÃ­o: ~1-2 segundos por socio

### AuditorÃ­a

Cada envÃ­o se registra en:
- `functions/index.js` - Logs de Cloud Function
- Firebase Console â†’ Functions â†’ Logs
- Cada mensaje exitoso: `âœ… [CANAL] enviado a [DESTINATARIO]`

---

## ğŸ› Troubleshooting

### El modal no abre

**Problema**: Hago clic en "Enviar por Email" pero no pasa nada  
**SoluciÃ³n**:
1. Verifica que hay socios **pendientes** (estado = 'pendiente')
2. Abre la consola del navegador (F12 â†’ Console)
3. Revisa si hay errores de red

### El botÃ³n "Enviar" no funciona

**Problema**: Hago clic en "âœ… Enviar X Recordatorios" pero nada pasa  
**SoluciÃ³n**:
1. Verifica la conexiÃ³n a internet
2. Abre la consola (F12 â†’ Network)
3. Busca la peticiÃ³n a `https://us-central1-club-738-app.cloudfunctions.net/enviarRecordatorios`
4. Si dice "Blocked by CSP" â†’ Contacta al admin (error de configuraciÃ³n)

### Los mensajes se ven cortados

**Problema**: El textarea en mobile no muestra todo el contenido  
**SoluciÃ³n**:
1. Scroll dentro del textarea (estÃ¡ habilitado)
2. En desktop deberÃ­as ver todo sin problemas
3. Si el problema persiste, reporta al admin

### No se enviÃ³ el recordatorio a un socio

**Problema**: El modal dice "7 enviados" pero el socio no recibiÃ³ nada  
**SoluciÃ³n**:
1. Verifica que el **email/telÃ©fono es correcto** en Firestore
2. Chequea la carpeta de SPAM del destinatario
3. Revisa los logs de Cloud Function en Firebase Console
4. Si el problema persiste, registra manualmente (RegistroPagos)

---

## ğŸ“ˆ Mejoras Futuras

- [ ] Historial de recordatorios enviados
- [ ] Plantillas de mensajes guardables
- [ ] Vista previa de email HTML (formato final)
- [ ] IntegraciÃ³n real de WhatsApp (actualmente simulado)
- [ ] ProgramaciÃ³n de envÃ­os (enviar en X fecha/hora)
- [ ] Analytics: tasa de apertura, clics, conversiones
- [ ] A/B testing de mensajes

---

## ğŸ“ Soporte

Si tienes problemas con el modal:

1. **Reporta en**: Issues â†’ GitHub
2. **Incluye**: NÃºmero de socios, quÃ© error ves, screenshot
3. **Admin**: admin@club738.com

---

**VersiÃ³n**: v1.35.4  
**Ãšltima ActualizaciÃ³n**: 24 Enero 2026  
**Estado**: ProducciÃ³n âœ…

